<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Global Health & Wellness News | ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏î‡∏µ</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#060B0A;
      --bg1:#07100C;
      --panel: rgba(10, 16, 12, .66);
      --panel2: rgba(9, 14, 11, .78);
      --border: rgba(16,185,129,.18);
      --border2: rgba(255,255,255,.07);
      --text:#EAF7F0;
      --muted:#A7C9B7;
      --muted2:#7FA691;
      --accent:#10b981;
      --accent2:#34d399;
      --warn:#f59e0b;
      --danger:#ef4444;
      --pill:#0b1912;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 8px 22px rgba(0,0,0,.35);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Outfit', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:
        radial-gradient(1200px 600px at 18% 10%, rgba(16,185,129,.16), transparent 55%),
        radial-gradient(900px 500px at 86% 6%, rgba(245,158,11,.11), transparent 58%),
        radial-gradient(700px 500px at 60% 92%, rgba(52,211,153,.10), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 60%, #050907);
      color:var(--text);
      overflow-x:hidden;
    }

    /* subtle grid */
    body::before{
      content:'';
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        linear-gradient(rgba(255,255,255,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.02) 1px, transparent 1px);
      background-size: 34px 34px;
      opacity:.28;
      mix-blend-mode: overlay;
    }

    a{color:inherit}

    /* ===== Header ===== */
    .top{
      max-width: 1220px;
      margin: 28px auto 0;
      padding: 0 20px;
    }
    .brand{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding: 18px 18px;
      border-radius: var(--radius);
      border: 1px solid var(--border2);
      background: linear-gradient(180deg, rgba(9,14,11,.72), rgba(7,11,9,.52));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
    }
    .brand-left{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:
        radial-gradient(circle at 30% 30%, rgba(52,211,153,.95), rgba(16,185,129,.35) 55%, rgba(0,0,0,.2) 100%);
      border: 1px solid rgba(52,211,153,.35);
      box-shadow: 0 10px 25px rgba(16,185,129,.18);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo::after{
      content:'';
      position:absolute; inset:-30%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.25), transparent);
      transform: rotate(15deg);
      animation: sheen 5.6s ease-in-out infinite;
    }
    @keyframes sheen{
      0%{transform: translateX(-40%) rotate(15deg); opacity:0}
      18%{opacity:.55}
      38%{transform: translateX(65%) rotate(15deg); opacity:.12}
      100%{opacity:0}
    }

    .titles{min-width:0}
    .title{
      margin:0;
      font-family:'Playfair Display', serif;
      font-weight: 700;
      letter-spacing:.2px;
      font-size: 20px;
      line-height:1.1;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .subtitle{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      letter-spacing:.2px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .meta-pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(16,185,129,.08);
      border: 1px solid rgba(16,185,129,.18);
      color: #cfeede;
      font-size: 12px;
      white-space:nowrap;
    }

    .brand-right{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .status{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .status-dot{
      width:8px;height:8px;border-radius:99px;
      background: rgba(255,255,255,.18);
      box-shadow: 0 0 0 3px rgba(255,255,255,.04);
    }
    .status-ok .status-dot{ background: rgba(16,185,129,.95); box-shadow: 0 0 0 3px rgba(16,185,129,.12); }
    .status-partial .status-dot{ background: rgba(245,158,11,.95); box-shadow: 0 0 0 3px rgba(245,158,11,.12); }
    .status-err .status-dot{ background: rgba(239,68,68,.95); box-shadow: 0 0 0 3px rgba(239,68,68,.12); }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 14px;
      border: 1px solid rgba(16,185,129,.22);
      background: rgba(16,185,129,.08);
      color: #d8fff0;
      font-size: 13px;
      text-decoration:none;
      cursor:pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      white-space:nowrap;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(16,185,129,.12); border-color: rgba(52,211,153,.30);}
    .btn:active{ transform: translateY(0px) scale(.98); }
    .btn.secondary{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
    }
    .btn.secondary:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.13); color:#e9fff6; }

    /* ===== Controls ===== */
    .controls{
      max-width: 1220px;
      margin: 16px auto 0;
      padding: 0 20px;
    }
    .controls-wrap{
      border-radius: var(--radius);
      border: 1px solid var(--border2);
      background: linear-gradient(180deg, rgba(9,14,11,.70), rgba(7,11,9,.50));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .filters{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .filter-left{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }

    .filter-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
    }
    .filter-btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.16); }
    .filter-btn.active{
      border-color: rgba(16,185,129,.30);
      background: rgba(16,185,129,.10);
      color:#dcfff1;
    }
    .filter-count{
      opacity:.8;
      font-size:12px;
    }

    .toggles{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      justify-content:flex-end;
    }
    .toggle{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size: 12.5px;
      user-select:none;
    }
    .toggle input{ accent-color: var(--accent); }

    .search-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    .searchbox{
      flex: 1 1 320px;
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.0);
      transition: border-color .14s ease, background .14s ease;
    }
    .searchbox:focus-within{
      border-color: rgba(16,185,129,.30);
      background: rgba(16,185,129,.05);
    }
    .searchbox input{
      flex:1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-size: 14px;
    }
    .searchbox input::placeholder{ color: rgba(167,201,183,.65); }

    .sortbox{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    select{
      background: transparent;
      border:none;
      outline:none;
      color: var(--text);
      font-size: 14px;
      cursor:pointer;
    }
    select option{ background: #0b1410; color:#eafff4; }

    /* ===== Partial Banner & Errors ===== */
    .banner{
      max-width: 1220px;
      margin: 12px auto 0;
      padding: 0 20px;
      display:none;
    }
    .banner.show{display:block}
    .banner-inner{
      border-radius: 18px;
      border: 1px solid rgba(245,158,11,.26);
      background: rgba(245,158,11,.08);
      color: #ffe7c2;
      padding: 12px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .banner-inner .small{color:#ffd9a0; font-size:12.5px}

    .errors{
      max-width: 1220px;
      margin: 10px auto 0;
      padding: 0 20px;
      display:none;
    }
    .errors.show{display:block}
    .errors-inner{
      border-radius: 18px;
      border: 1px solid rgba(239,68,68,.25);
      background: rgba(239,68,68,.07);
      color: #ffd4d4;
      padding: 12px 14px;
      font-size: 12.5px;
      white-space:pre-wrap;
    }

    /* ===== Executive Summary ===== */
    .exec{
      max-width: 1220px;
      margin: 18px auto 0;
      padding: 0 20px;
      display:none;
    }
    .exec-wrap{
      border-radius: var(--radius);
      border: 1px solid rgba(16,185,129,.22);
      background: linear-gradient(180deg, rgba(16,185,129,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(12px);
      padding: 18px 18px 14px;
      position:relative;
      overflow:hidden;
    }
    .exec-wrap::before{
      content:'';
      position:absolute;
      inset:-120px -80px auto auto;
      width: 260px; height: 260px;
      background: radial-gradient(circle at 30% 30%, rgba(52,211,153,.25), transparent 60%);
      transform: rotate(22deg);
      pointer-events:none;
    }
    .exec-head{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }
    .exec-title{
      margin:0;
      font-family:'Playfair Display', serif;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .exec-sub{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 12.5px;
    }
    .exec-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .exec-col{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      padding: 12px 12px;
      min-height: 110px;
    }
    .exec-col-title{
      display:flex;
      align-items:center;
      gap:8px;
      font-size: 13px;
      color: #dcfff1;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .exec-col:nth-child(1) .exec-col-title{color:#a7f3d0}
    .exec-col:nth-child(2) .exec-col-title{color:#93c5fd}
    .exec-col:nth-child(3) .exec-col-title{color:#f59e0b}
    .exec-col:nth-child(3) .exec-col-title{color:#f472b6}
    .exec-item{font-size:13px;line-height:1.6;color:#b0c8ba;padding:4px 0 4px 14px;position:relative;border-bottom:1px solid rgba(16,185,129,.06)}
    .exec-item:last-child{border-bottom:none}
    .exec-item::before{content:'‚ñ∏';position:absolute;left:0;color:#10b981;font-size:
11px}
    .exec-item[data-url]{cursor:pointer}
    .exec-item .link-icon{opacity:0;transition:opacity .15s ease;margin-left:6px;font-size:12px}
    .exec-item:hover .link-icon{opacity:1}

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê METHODOLOGY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .methodology{padding:0 36px;margin-top:24px;animation:fadeSlideUp 1s ease-out}
    .methodology-title{font-family:'Playfair Display',serif;font-size:18px;margin:0 0 10px;color:#dcfff1}
    .method-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
    .method-box{background:rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:14px 14px}
    .method-box h4{margin:0 0 8px;font-size:13px;color:#d8fff0;display:flex;gap:8px;align-items:center}
    .method-box p{margin:0;color:var(--muted);font-size:12.5px;line-height:1.55}
    .pill-mini{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid rgba(16,185,129,.22);background:rgba(16,185,129,.08);color:#d8fff0;font-size:11.5px;margin-right:6px;margin-top:6px;white-space:nowrap}
    .method-footer{margin-top:12px;color:rgba(167,201,183,.85);font-size:12px}

    /* ===== Cards ===== */
    .main{
      max-width: 1220px;
      margin: 18px auto 40px;
      padding: 0 20px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }

    .card{
      position:relative;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(9,14,11,.72), rgba(0,0,0,.20));
      box-shadow: var(--shadow2);
      padding: 16px 16px 14px;
      overflow:hidden;
      animation: fadeSlideUp .55s ease both;
      transform-origin: center;
    }
    .card::before{
      content:'';
      position:absolute;
      inset:0;
      pointer-events:none;
      background: radial-gradient(420px 220px at 10% 0%, rgba(16,185,129,.14), transparent 56%);
      opacity:.9;
      mix-blend-mode: screen;
    }
    .card-badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 11.5px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(16,185,129,.08);
      border: 1px solid rgba(16,185,129,.20);
      color: #d9fff1;
      letter-spacing: .25px;
      margin-bottom: 10px;
      position:relative;
      z-index:1;
    }
    .card-title{
      margin: 0;
      font-size: 16px;
      line-height: 1.25;
      letter-spacing: .2px;
      position:relative;
      z-index:1;
      font-weight:700;
    }
    .card-summary{
      margin: 10px 0 0;
      color: var(--muted);
      font-size: 13.5px;
      line-height: 1.55;
      position:relative;
      z-index:1;
      min-height: 56px;
    }

    .card-strategy{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(16,185,129,.14);
      background: rgba(16,185,129,.06);
      position:relative;
      z-index:1;
    }
    .card-strategy-label{
      font-size: 11.5px;
      color: #d9fff1;
      letter-spacing:.25px;
      margin-bottom: 6px;
      font-weight:600;
    }
    .card-strategy-text{
      font-size: 12.8px;
      line-height: 1.55;
      color: rgba(234,247,240,.90);
    }

    .card-source{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-top: 14px;
      color: rgba(167,201,183,.85);
      font-size: 12px;
      position:relative;
      z-index:1;
    }
    .card-source a{
      color: rgba(52,211,153,.95);
      text-decoration:none;
    }
    .card-source a:hover{text-decoration:underline}
    .card-actions{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .btn-mini{
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .btn-mini:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.14); color:#eafff4}
    .btn-mini:active{transform: translateY(0px) scale(.98)}
    .btn-mini.open{ border-color: rgba(16,185,129,.22); background: rgba(16,185,129,.08); color:#d8fff0; }
    .btn-mini.open:hover{ background: rgba(16,185,129,.12); border-color: rgba(52,211,153,.30); }

    /* ===== Loading / Error ===== */
    .center{
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 44px 0;
      color: var(--muted);
    }
    .spinner{
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,.14);
      border-top-color: rgba(16,185,129,.9);
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }
    @keyframes spin{
      to{transform: rotate(360deg)}
    }
    .error{
      display:none;
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(239,68,68,.25);
      background: rgba(239,68,68,.07);
      color: #ffd4d4;
      margin-top: 12px;
      white-space:pre-wrap;
    }
    .error.show{display:block}

    /* ===== Toast ===== */
    .toast{
      position: fixed;
      right: 18px;
      bottom: 18px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(16,185,129,.18);
      background: rgba(9,14,11,.85);
      box-shadow: var(--shadow2);
      color: #dcfff1;
      font-size: 13px;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .16s ease, transform .16s ease;
      z-index: 9999;
      backdrop-filter: blur(10px);
      pointer-events:none;
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0px);
    }

    /* ===== Tooltip (reused for hover/tap) ===== */
    .tip{ position:relative; }
    .tip::after{
      content: attr(data-tip);
      position:absolute;
      left: 50%;
      bottom: calc(100% + 10px);
      transform: translateX(-50%) translateY(6px);
      background: rgba(8,13,10,.92);
      color: #eafff4;
      border: 1px solid rgba(255,255,255,.10);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 12.5px;
      line-height: 1.35;
      box-shadow: var(--shadow2);
      width: min(380px, 92vw);
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease, transform .14s ease;
      z-index: 9999;
      backdrop-filter: blur(10px);
      white-space: normal;
    }
    .tip:hover::after{ opacity:1; transform: translateX(-50%) translateY(0px); animation: tipPop .22s ease; }
    .tip.tip-open::after{ opacity:1; transform: translateX(-50%) translateY(0px); animation: tipPop .22s ease; }

    @keyframes tipPop{
      0%{transform: translateX(-50%) scale(.98); opacity:0}
      100%{transform: translateX(-50%) scale(1); opacity:1}
    }

    /* ===== Animations ===== */
    @keyframes fadeSlideUp{
      from{opacity:0; transform: translateY(10px)}
      to{opacity:1; transform: translateY(0px)}
    }

    /* ===== Responsive ===== */
    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, minmax(0,1fr));}
      .exec-grid{grid-template-columns: 1fr; }
      .method-grid{grid-template-columns: 1fr; }
    }
    @media (max-width: 640px){
      .brand{padding: 14px 14px;}
      .title{font-size: 18px}
      .grid{grid-template-columns: 1fr;}
      .controls-wrap{padding: 12px;}
      .card{padding: 14px 14px 12px}
      .toast{right: 12px; bottom: 12px;}
      .methodology{padding: 0 18px;}
    }
  </style>
</head>

<body>
  <div class="top">
    <div class="brand">
      <div class="brand-left">
        <div class="logo" aria-hidden="true"></div>
        <div class="titles">
          <h1 class="title">Global Health & Wellness News</h1>
          <div class="subtitle">
            <span class="meta-pill tip" data-tip="‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô STATIC dashboard ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ./data.json ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏°)" aria-expanded="false">üßä Static ‚Ä¢ Public</span>
            <span class="meta-pill tip" data-tip="‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≤‡∏Å GitHub Actions ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ù‡∏±‡πà‡∏á Publisher ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)" aria-expanded="false">‚è± Auto Refresh</span>
            <span class="meta-pill tip" data-tip="Copy ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á LINE ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ/Exec ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ" aria-expanded="false">üìã LINE-ready</span>
          </div>
        </div>
      </div>

      <div class="brand-right">
        <div id="statusPill" class="status status-ok tip" data-tip="OK = ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Ä¢ PARTIAL = ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏µ error ‚Ä¢ ERROR = ‡πÇ‡∏´‡∏•‡∏î data.json ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ" aria-expanded="false">
          <span class="status-dot"></span>
          <span id="statusText">OK</span>
        </div>

        <a class="btn secondary tip" data-tip="‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå data.json ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö raw)" href="./data.json" target="_blank" rel="noopener" aria-expanded="false">üßæ data.json</a>
        <button class="btn tip" id="btnReload" data-tip="‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å data.json" aria-expanded="false">üîÑ Reload</button>
      </div>
    </div>
  </div>

  <div class="controls">
    <div class="controls-wrap">
      <div class="filters">
        <div class="filter-left">
          <button class="filter-btn active" data-filter="all">All <span id="countAll" class="filter-count">(0)</span></button>
          <button class="filter-btn" data-filter="global">Global <span id="countGlobal" class="filter-count">(0)</span></button>
          <button class="filter-btn" data-filter="apac">APAC <span id="countApac" class="filter-count">(0)</span></button>
          <button class="filter-btn" data-filter="thailand">Thailand <span id="countThailand" class="filter-count">(0)</span></button>
          <button class="filter-btn" data-filter="research">Research <span id="countResearch" class="filter-count">(0)</span></button>
        </div>

        <div class="toggles">
          <label class="toggle tip" data-tip="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 'Reputable' ‡∏ï‡∏≤‡∏° flag ‡πÉ‡∏ô data.json" aria-expanded="false">
            <input type="checkbox" id="tgReputable" checked>
            Reputable
          </label>
          <label class="toggle tip" data-tip="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 'Proposal-friendly' ‡∏ï‡∏≤‡∏° flag ‡πÉ‡∏ô data.json" aria-expanded="false">
            <input type="checkbox" id="tgProposal" checked>
            Proposal-friendly
          </label>
        </div>
      </div>

      <div class="search-row">
        <div class="searchbox tip" data-tip="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å Title / Summary / Source / Strategic / Tag / Region" aria-expanded="false">
          üîé
          <input id="searchInput" type="text" placeholder="Search‚Ä¶ (‡πÄ‡∏ä‡πà‡∏ô GLP-1, skin, ‡∏£‡∏û. ‡∏®‡∏¥‡∏£‡∏¥‡∏£‡∏≤‡∏ä, Mayo, WHO)">
          <span id="searchClear" style="cursor:pointer;opacity:.75">‚úï</span>
        </div>

        <div class="sortbox tip" data-tip="‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô data.json)" aria-expanded="false">
          ‚ÜïÔ∏è
          <select id="sortSelect">
            <option value="newest">Newest</option>
            <option value="oldest">Oldest</option>
            <option value="region">Region</option>
            <option value="source">Source</option>
          </select>
        </div>

        <div class="tip" data-tip="‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô calls ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ/‡∏á‡∏ö‡∏à‡∏≤‡∏Å meta ‡πÉ‡∏ô data.json (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" aria-expanded="false">
          <span class="meta-pill">üì¶ <span id="callsMeta">‚Äî</span></span>
        </div>
      </div>
    </div>
  </div>

  <div id="partialBanner" class="banner">
    <div class="banner-inner">
      <div>
        <div><b>PARTIAL UPDATE</b> ‚Äî ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö</div>
        <div id="partialNote" class="small">‚Äî</div>
      </div>
      <div class="small">‚úÖ ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥</div>
    </div>
  </div>

  <div id="errorPanel" class="errors">
    <div class="errors-inner"></div>
  </div>

  <div id="execSummary" class="exec">
    <div class="exec-wrap">
      <div class="exec-head">
        <div>
          <h2 class="exec-title">Executive Summary</h2>
          <div class="exec-sub">Hover (desktop) ‡∏´‡∏£‡∏∑‡∏≠ Tap (mobile) ‡∏ó‡∏µ‡πà bullet ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ ‚Ä¢ ‡∏Ñ‡∏•‡∏¥‡∏Å/‡πÅ‡∏ï‡∏∞‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß</div>
        </div>
        <div class="meta-pill tip" data-tip="Exec Summary ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å pipeline ‡πÅ‡∏•‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô data.json ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô" aria-expanded="false">üß† Daily Insight</div>
      </div>

      <div class="exec-grid">
        <div class="exec-col">
          <div class="exec-col-title">üåç ‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô</div>
          <div id="execTrends"></div>
        </div>
        <div class="exec-col">
          <div class="exec-col-title">üéØ ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå</div>
          <div id="execStrategic"></div>
        </div>
        <div class="exec-col">
          <div class="exec-col-title">üìç ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô</div>
          <div id="execLocal"></div>
        </div>
      </div>

      <div class="methodology">
        <h3 class="methodology-title">Methodology (How this dashboard works)</h3>
        <div class="method-grid">
          <div class="method-box">
            <h4>üßä Static Public Dashboard <span class="pill-mini">No Login</span></h4>
            <p>‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô static HTML ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å <b>./data.json</b> ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏°</p>
          </div>
          <div class="method-box">
            <h4>üõ°Ô∏è Security Boundary <span class="pill-mini">No API Key</span></h4>
            <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà API key ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ‡∏ú‡∏π‡πâ‡∏ä‡∏°‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</p>
          </div>
          <div class="method-box">
            <h4>üí∏ Cost Model <span class="pill-mini">Publisher Pays</span></h4>
            <p>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏î‡∏ï‡∏≠‡∏ô pipeline (GitHub Actions) ‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß/‡∏™‡∏£‡∏∏‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô data.json ‡∏ú‡∏π‡πâ‡∏ä‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</p>
          </div>
        </div>
        <div class="method-footer">Tip: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô PARTIAL ‡πÉ‡∏´‡πâ‡∏î‡∏π Errors ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö data.json ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏î‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
      </div>
    </div>
  </div>

  <div class="main">
    <div id="loading" class="center">
      <div class="spinner"></div>
      <div>Loading data.json‚Ä¶</div>
    </div>

    <div id="errorEl" class="error"></div>

    <div id="cardsGrid" class="grid" style="display:none;"></div>
  </div>

  <div id="toast" class="toast">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ</div>

  <script>
  (() => {
    /* ===== Constants ===== */
    const LABELS = {
      global: 'GLOBAL',
      apac: 'APAC',
      thailand: 'TH',
      research: 'RESEARCH'
    };

    const COLORS = {
      global: { bg:'rgba(147,197,253,.10)', border:'rgba(147,197,253,.22)', text:'#cfe8ff' },
      apac: { bg:'rgba(52,211,153,.10)', border:'rgba(52,211,153,.22)', text:'#d8fff0' },
      thailand: { bg:'rgba(245,158,11,.10)', border:'rgba(245,158,11,.24)', text:'#ffe4b5' },
      research: { bg:'rgba(139,92,246,.10)', border:'rgba(139,92,246,.24)', text:'#e6dbff' }
    };

    // Marker used in pipeline
    const RESEARCH_TAG_PREFIX = 'RESEARCH_TAG_PREFIX::';

    let allItems = [];
    let titleIndex = new Map();
    let currentFilter = 'all';
    let searchTerm = '';
    let sortMode = 'newest';
    let showReputable = true;
    let showProposal = true;

    const toast = document.getElementById('toast');

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), 1200);
    }

    function mapCategory(item){
      const tag = String(item.query_tag || '');
      if (tag.startsWith(RESEARCH_TAG_PREFIX)) return 'research';

      const r = String(item.region || '').toLowerCase(); // global/regional/local
      if (r === 'global') return 'global';
      if (r === 'regional') return 'apac';
      if (r === 'local') return 'thailand';
      return 'global';
    }

    function escHtml(str) {
      const d = document.createElement('div');
      d.textContent = String(str || '');
      return d.innerHTML;
    }

function escAttr(str){
  // Escape for HTML attributes (quotes-safe)
  return escHtml(str).replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function normTitle(str){
  return String(str||'')
    .toLowerCase()
    .replace(/[\u200B-\u200D\uFEFF]/g,'')
    .replace(/[‚Äú‚Äù"‚Äô'`]/g,'')
    .replace(/[^\p{L}\p{N}]+/gu,' ')
    .trim();
}

function buildTitleIndex(items){
  titleIndex = new Map();
  (items||[]).forEach(it=>{
    const t = it && it.title ? normTitle(it.title) : '';
    if (!t) return;
    if (!titleIndex.has(t)) titleIndex.set(t, it);
  });
}

function findItemForBullet(text){
  const nt = normTitle(text);
  if (!nt) return null;
  if (titleIndex.has(nt)) return titleIndex.get(nt);

  // Fuzzy: try "startsWith" / "includes" match against indexed titles
  // (small index size; safe to scan)
  let best = null;
  let bestScore = 0;
  for (const [k, it] of titleIndex.entries()){
    if (!k) continue;
    let score = 0;
    if (k === nt) score = 100;
    else if (k.startsWith(nt) || nt.startsWith(k)) score = 85;
    else if (k.includes(nt) || nt.includes(k)) score = 70;

    // prefer longer overlap
    if (score){
      score += Math.min(k.length, nt.length) / 10;
      if (score > bestScore){
        bestScore = score;
        best = it;
      }
    }
  }
  return best;
}

    function buildLineText(item){
      const cat = mapCategory(item);
      const regionLabel =
        cat === 'global' ? 'üåç GLOBAL' :
        cat === 'apac' ? 'üåè APAC' :
        cat === 'thailand' ? 'üáπüá≠ TH' :
        'üî¨ RESEARCH';

      const lines = [];
      lines.push(`${regionLabel} ‚Äî ${item.title || ''}`.trim());
      if (item.summary) lines.push(`üß† ${item.summary}`);
      if (item.strategic_implication) lines.push(`üéØ ${item.strategic_implication}`);
      if (item.source) lines.push(`üì∞ ${item.source}`);
      if (item.url) lines.push(`üîó ${item.url}`);
      return lines.join('\n').trim();
    }

    function sortItems(items){
      const copy = [...items];
      if (sortMode === 'source'){
        copy.sort((a,b)=> String(a.source||'').localeCompare(String(b.source||'')));
      } else if (sortMode === 'region'){
        const rank = { global: 1, apac: 2, thailand: 3, research: 4 };
        copy.sort((a,b)=> (rank[mapCategory(a)]||9) - (rank[mapCategory(b)]||9));
      } else if (sortMode === 'oldest'){
        copy.sort((a,b)=> (a.published_at||'').localeCompare(b.published_at||''));
      } else {
        // newest
        copy.sort((a,b)=> (b.published_at||'').localeCompare(a.published_at||''));
      }
      return copy;
    }

    function applySearch(items){
      if (!searchTerm) return items;
      const q = searchTerm.toLowerCase();
      return items.filter(it=>{
        const hay = [
          it.title, it.summary, it.source, it.strategic_implication, it.query_tag, it.region
        ].map(v=>String(v||'').toLowerCase()).join(' ');
        return hay.includes(q);
      });
    }

    function applyToggles(items){
      return items.filter(it=>{
        const rep = it.reputable !== false; // default true
        const prop = it.proposal_friendly !== false; // default true
        if (!showReputable && rep) return false;
        if (!showProposal && prop) return false;
        return true;
      });
    }

    function syncToggleUI(){
      document.getElementById('tgReputable').checked = showReputable;
      document.getElementById('tgProposal').checked = showProposal;
    }

    /* ===== Tooltip: tap to open/close (mobile friendly) ===== */
    // Implemented with CSS ::after + class "tip-open"
    let openEl = null;

    function closeTip(el){
      if (!el) return;
      el.classList.remove('tip-open');
      el.setAttribute('aria-expanded','false');
    }
    function openTip(el){
      if (!el) return;
      el.classList.add('tip-open');
      el.setAttribute('aria-expanded','true');
      openEl = el;
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll('.tip[data-tip]').forEach((el)=>{
        // do NOT override actual controls; just add accessibility.
        if (!el.hasAttribute('aria-expanded')) el.setAttribute('aria-expanded','false');
      });

      // Mobile/Touch: tap toggles tooltip (doesn't block actual click behavior)
      document.addEventListener('pointerdown', (e)=>{
        // Only treat touch/pen as "tap tooltip"
        if (e.pointerType !== 'touch' && e.pointerType !== 'pen') return;

        const tip = e.target.closest('.tip[data-tip]');
        if (!tip){
          closeTip(openEl);
          openEl = null;
          return;
        }

        // toggle
        if (openEl === tip){
          closeTip(openEl);
          openEl = null;
        } else {
          closeTip(openEl);
          openTip(tip);
        }
      }, { passive: true });

      // Close tooltip on scroll (mobile-friendly)
      window.addEventListener('scroll', ()=>{
        closeTip(openEl);
        openEl = null;
      }, { passive: true });

      // Close on click outside (desktop too)
      document.addEventListener('click', (e)=>{
        const tip = e.target.closest('.tip[data-tip]');
        if (!tip){
          closeTip(openEl);
          openEl = null;
        }
      }, { passive: true });

    // Exec bullets: Desktop click opens source; Mobile tap 1 shows tip, tap 2 opens source
    let lastExecTap = null;
    let lastExecTapTimer = null;
    function isTouchLike(){
      return window.matchMedia && window.matchMedia('(hover: none)').matches;
    }

    document.addEventListener('click', (e)=>{
      const el = e.target.closest('.exec-item[data-url]');
      if (!el) return;

      const url = el.getAttribute('data-url');
      if (!url) return;

      if (!isTouchLike()){
        window.open(url, '_blank', 'noopener,noreferrer');
        return;
      }

      // Touch: first tap = open tooltip only
      if (lastExecTap !== el){
        lastExecTap = el;
        clearTimeout(lastExecTapTimer);
        lastExecTapTimer = setTimeout(()=>{ lastExecTap = null; }, 1600);

        // Ensure tooltip is visible
        closeTip(openEl);
        openTip(el);
        openEl = el;
        return;
      }

      // Second tap opens source
      window.open(url, '_blank', 'noopener,noreferrer');
    }, { passive: true });

    // Escape closes
      document.addEventListener('keydown', (e)=>{
        if (e.key === 'Escape'){
          closeTip(openEl);
          openEl = null;
        }
      });
    });
  })();

  /* ===== Data load ===== */
async function loadData() {
  const loading = document.getElementById('loading');
  const grid = document.getElementById('cardsGrid');
  const errorEl = document.getElementById('errorEl');

  errorEl.classList.remove('show');
  loading.classList.add('show');
  grid.style.display = 'none';

  try {
    const res = await fetch('./data.json', { cache: 'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
    const data = await res.json();

    // meta: calls, date, etc.
    const callsMeta = document.getElementById('callsMeta');
    if (callsMeta){
      callsMeta.textContent = (data && data.meta && data.meta.calls_used != null)
        ? `${data.meta.calls_used}/${data.meta.calls_budget} ‚Ä¢ ${data?.meta?.partial ? 'PARTIAL' : 'OK'}`
        : '‚Äî';
    }

    // Status Pill
    const pill = document.getElementById('statusPill');
    const st = document.getElementById('statusText');
    const isPartial = !!data?.meta?.partial;
    if (pill && st){
      pill.classList.remove('status-ok','status-partial','status-err');
      if (isPartial){
        pill.classList.add('status-partial');
        st.textContent = 'PARTIAL';
      } else {
        pill.classList.add('status-ok');
        st.textContent = 'OK';
      }
    }

    // Partial banner
    if (data?.meta?.partial) {
      const banner = document.getElementById('partialBanner');
      banner.textContent = data?.meta?.notes ? data.meta.notes : `${data.meta.calls_used}/${data.meta.calls_budget} sources updated ‚Äî PARTIAL`;
      banner.classList.add('show');
    } else {
      document.getElementById('partialBanner').classList.remove('show');
    }

    // Error panel (optional meta.errors)
    const ep = document.getElementById('errorPanel');
    const errs = Array.isArray(data?.meta?.errors) ? data.meta.errors : [];
    if (ep){
      if (errs.length){
        ep.style.display = 'block';
        ep.classList.add('show');
        ep.textContent = `‚ö†Ô∏è Errors: ${errs.map(e=>String(e.tag||e)).join(', ')}`;
      } else {
        ep.style.display = 'none';
        ep.classList.remove('show');
      }
    }

    // Items
    allItems = Array.isArray(data.items) ? data.items : [];
    buildTitleIndex(allItems);

    // Exec summary
    if (data?.executive_summary) {
      renderExecSummary(data.executive_summary);
      document.getElementById('execSummary').style.display = '';
    }
    updateCounts();
    syncToggleUI();
    renderCards();

    loading.classList.remove('show');
    grid.style.display = '';
  } catch (e) {
    console.error('Failed to load data:', e);
    loading.classList.remove('show');
    errorEl.classList.add('show');

    const pill = document.getElementById('statusPill');
    const st = document.getElementById('statusText');
    if (pill && st){
      pill.classList.remove('status-ok','status-partial','status-err');
      pill.classList.add('status-err');
      st.textContent = 'ERROR';
    }
  }
}

function renderExecSummary(es) {
  const trendsEl = document.getElementById('execTrends');
  const stratEl = document.getElementById('execStrategic');
  const localEl = document.getElementById('execLocal');

  function renderBullet(text){
    const it = findItemForBullet(text);
    const tip = it ? (it.summary || it.strategic_implication || it.title || text) : text;
    const url = it ? (it.url || '') : '';
    return `<div class="exec-item tip" data-tip="${escAttr(tip)}"${url ? ` data-url="${escAttr(url)}"` : ''}>
      ${escHtml(text)}${url ? `<span class="link-icon" aria-label="Open source">üîó</span>` : ``}
    </div>`;
  }

  trendsEl.innerHTML = (es.trends || []).map(renderBullet).join('');
  stratEl.innerHTML = (es.strategic || []).map(renderBullet).join('');
  localEl.innerHTML = (es.local || []).map(renderBullet).join('');

  // Accessibility init for newly injected tips
  document.querySelectorAll('.exec-item.tip[data-tip]').forEach(el=>{
    if (!el.hasAttribute('aria-expanded')) el.setAttribute('aria-expanded','false');
  });
}

function updateCounts() {
  const counts = { all: allItems.length, global: 0, apac: 0, thailand: 0, research: 0 };
  allItems.forEach(it => { const k = mapCategory(it); if (counts[k] != null) counts[k]++; });

  document.getElementById('countAll').textContent = `(${counts.all})`;
  document.getElementById('countGlobal').textContent = `(${counts.global})`;
  document.getElementById('countApac').textContent = `(${counts.apac})`;
  document.getElementById('countThailand').textContent = `(${counts.thailand})`;
  document.getElementById('countResearch').textContent = `(${counts.research})`;
}

function setFilter(filter) {
  currentFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(btn => {
    if (!btn.dataset.filter) return;
    btn.classList.toggle('active', btn.dataset.filter === filter);
  });
  renderCards();
}

function applySearch(items){
  if (!searchTerm) return items;
  const q = searchTerm.toLowerCase();
  return items.filter(it=>{
    const hay = [
      it.title, it.summary, it.source, it.strategic_implication, it.query_tag, it.region
    ].map(v=>String(v||'').toLowerCase()).join(' ');
    return hay.includes(q);
  });
}

function applyToggles(items){
  return items.filter(it=>{
    const rep = it.reputable !== false;
    const prop = it.proposal_friendly !== false;
    if (!showReputable && rep) return false;
    if (!showProposal && prop) return false;
    return true;
  });
}

function sortItems(items){
  const copy = [...items];
  if (sortMode === 'source'){
    copy.sort((a,b)=> String(a.source||'').localeCompare(String(b.source||'')));
  } else if (sortMode === 'region'){
    const rank = { global: 1, apac: 2, thailand: 3, research: 4 };
    copy.sort((a,b)=> (rank[mapCategory(a)]||9) - (rank[mapCategory(b)]||9));
  } else if (sortMode === 'oldest'){
    copy.sort((a,b)=> (a.published_at||'').localeCompare(b.published_at||''));
  } else {
    copy.sort((a,b)=> (b.published_at||'').localeCompare(a.published_at||''));
  }
  return copy;
}

function renderCards() {
  const grid = document.getElementById('cardsGrid');

  let items = currentFilter === 'all'
    ? allItems
    : allItems.filter(i => mapCategory(i) === currentFilter);

  items = applySearch(items);
  items = applyToggles(items);
  items = sortItems(items);

  if (!items.length){
    grid.innerHTML = `
      <div class="card" style="grid-column: 1 / -1;">
        <span class="card-badge" style="background:rgba(245,158,11,.12);color:#fbbf24;border:1px solid rgba(245,158,11,.25)">NO RESULTS</span>
        <h3 class="card-title">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h3>
        <p class="card-summary">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏°‡∏ß‡∏î (Filter) ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (Search) ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
      </div>
    `;
    return;
  }

  grid.innerHTML = items.map((item, idx) => {
    const cat = mapCategory(item);
    const rc = COLORS[cat] || COLORS.global;
    const label = LABELS[cat] || cat.toUpperCase();
    const delay = idx * 0.055;

    const openLink = item.url
      ? `<a class="btn-mini open" href="${escHtml(item.url)}" target="_blank" rel="noopener">üîó Open</a>`
      : `<span class="btn-mini open" style="opacity:.6;cursor:not-allowed">No link</span>`;

    return `
      <div class="card" style="animation-delay:${delay}s">
        <span class="card-badge" style="background:${rc.bg};color:${rc.text};border:1px solid ${rc.border}">${label}</span>
        <h3 class="card-title">${escHtml(item.title || '')}</h3>
        <p class="card-summary">${escHtml(item.summary || '')}</p>

        ${item.strategic_implication ? `
          <div class="card-strategy">
            <div class="card-strategy-label">Strategic Implication</div>
            <div class="card-strategy-text">${escHtml(item.strategic_implication)}</div>
          </div>
        ` : ''}

        <div class="card-source">
          <div>
            ${item.url
              ? `<a href="${escHtml(item.url)}" target="_blank" rel="noopener">${escHtml(item.source || 'Source')} ‚Üí</a>`
              : escHtml(item.source || 'Source')}
          </div>
          <div class="card-actions">
            ${openLink}
            <button class="btn-mini copy" data-copy="${idx}" data-copytype="line">üìã LINE</button>
            <button class="btn-mini copy" data-copy="${idx}" data-copytype="summary">‚úÇÔ∏è Summary</button>
            <button class="btn-mini copy" data-copy="${idx}" data-copytype="exec">üß† Exec</button>
          </div>
        </div>
      </div>
    `;
  }).join('');

  // Bind copy
  grid.querySelectorAll('button[data-copy]').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const idx = Number(btn.getAttribute('data-copy') || '0');
      const typ = String(btn.getAttribute('data-copytype') || 'line');

      let view = currentFilter === 'all' ? allItems : allItems.filter(i => mapCategory(i) === currentFilter);
      view = applySearch(view);
      view = applyToggles(view);
      view = sortItems(view);

      const item = view[idx];
      if (!item) return;

      let text = '';
      if (typ === 'summary'){
        text = `üì∞ ${item.title || ''}\nüß† ${item.summary || ''}\n${item.url ? `üîó ${item.url}` : ''}`.trim();
      } else if (typ === 'exec'){
        text = `üì∞ ${item.title || ''}\nüéØ ${item.strategic_implication || ''}\n${item.url ? `üîó ${item.url}` : ''}`.trim();
      } else {
        text = buildLineText(item);
      }

      try{
        await navigator.clipboard.writeText(text);
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
      } catch {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        ta.remove();
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ');
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', ()=>{
  const searchEl = document.getElementById('searchInput');
  const clearEl = document.getElementById('searchClear');
  const sortEl = document.getElementById('sortSelect');

  document.querySelectorAll('.filter-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> setFilter(btn.dataset.filter));
  });

  document.getElementById('tgReputable').addEventListener('change', (e)=>{
    showReputable = e.target.checked;
    renderCards();
  });
  document.getElementById('tgProposal').addEventListener('change', (e)=>{
    showProposal = e.target.checked;
    renderCards();
  });

  searchEl.addEventListener('input', ()=>{
    searchTerm = searchEl.value.trim();
    renderCards();
  });
  clearEl.addEventListener('click', ()=>{
    searchEl.value = '';
    searchTerm = '';
    renderCards();
  });

  sortEl.addEventListener('change', ()=>{
    sortMode = sortEl.value;
    renderCards();
  });

  document.getElementById('btnReload').addEventListener('click', loadData);

  loadData();
});
  </script>
</body>
</html>
