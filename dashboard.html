<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#071A2B" />
  <title>Global Health & Wellness News</title>
  <style>
    :root{
      --bg:#071A2B;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.08);
      --stroke:rgba(255,255,255,.12);
      --text:#F5FBFF;
      --muted:rgba(245,251,255,.72);
      --aqua:#2EE6D6;
      --green:#42F58D;
      --amber:#FFB020;
      --lav:#B6A6FF;
      --pink:#f472b6;
      --shadow: 0 12px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans Thai", "Noto Sans", sans-serif;
      background: radial-gradient(1200px 700px at 20% 10%, rgba(46,230,214,.20), transparent 55%),
                  radial-gradient(900px 600px at 80% 0%, rgba(66,245,141,.14), transparent 60%),
                  radial-gradient(900px 600px at 50% 100%, rgba(182,166,255,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    a{color:inherit}
    .wrap{max-width:1120px;margin:0 auto;padding:18px 14px 70px}
    .topbar{
      position:sticky;top:0;z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7,26,43,.90), rgba(7,26,43,.55));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar-inner{max-width:1120px;margin:0 auto;padding:14px 14px}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{
      display:flex;gap:10px;align-items:center;
      min-width:260px;
    }
    .globe{
      width:42px;height:42px;border-radius:14px;
      background: radial-gradient(circle at 30% 30%, rgba(46,230,214,.35), transparent 55%),
                  radial-gradient(circle at 70% 60%, rgba(66,245,141,.22), transparent 55%),
                  rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      display:grid;place-items:center;
    }
    .globe span{font-size:20px}
    .title{display:flex;flex-direction:column;gap:2px}
    .title b{font-size:16px;letter-spacing:.2px}
    .title small{color:var(--muted)}
    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,.22);
      display:flex;gap:8px;align-items:center;
      user-select:none;
    }
    .btn:hover{background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.18)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(46,230,214,.30);
      background: linear-gradient(180deg, rgba(46,230,214,.18), rgba(255,255,255,.06));
    }
    .pill{
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      display:flex;gap:8px;align-items:center;
      font-size:12px;
    }
    .pill b{color:var(--text);font-weight:700}
    .grid-bg{
      position:fixed;inset:0;pointer-events:none;opacity:.22;
      background-image:
        linear-gradient(rgba(255,255,255,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      mask-image: radial-gradient(circle at 40% 30%, rgba(0,0,0,1), rgba(0,0,0,0) 70%);
    }

    .hero{
      padding:22px 0 12px;
    }
    .hero h1{
      margin:8px 0 6px;
      font-size:26px;
      letter-spacing:.2px;
    }
    .hero p{margin:0;color:var(--muted)}
    .cards3{
      display:grid;gap:12px;
      grid-template-columns: repeat(12, 1fr);
      margin-top:14px;
    }
    .card{
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;inset:-1px;
      background: radial-gradient(400px 220px at 20% 0%, rgba(46,230,214,.16), transparent 60%),
                  radial-gradient(380px 220px at 90% 30%, rgba(66,245,141,.12), transparent 55%);
      opacity:.9;
      pointer-events:none;
    }
    .card > *{position:relative}
    .kicker{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px}
    .kicker b{font-size:13px}
    .kicker small{color:var(--muted)}
    .bullets{margin:0;padding-left:18px;color:var(--muted)}
    .bullets li{margin:6px 0}
    .card3-1{grid-column: span 4}
    .card3-2{grid-column: span 4}
    .card3-3{grid-column: span 4}
    @media (max-width: 980px){
      .card3-1,.card3-2,.card3-3{grid-column: span 12}
    }

    .controls{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      margin:14px 0 8px;
    }
    .search{
      flex: 1 1 260px;
      display:flex;gap:10px;align-items:center;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding:10px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
    }
    .search input{
      flex:1;
      background:transparent;border:0;outline:0;color:var(--text);
      font-size:14px;
    }
    .search input::placeholder{color: rgba(245,251,255,.55)}
    .chips{
      display:flex;gap:8px;flex-wrap:wrap;
      flex: 2 1 360px;
      align-items:center;
    }
    .chip{
      border-radius:999px;
      padding:9px 12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      transition: background .2s ease, border-color .2s ease, transform .06s ease;
      font-size:13px;
      display:flex;gap:8px;align-items:center;
    }
    .chip:active{transform: translateY(1px)}
    .chip.active{
      color:var(--text);
      border-color: rgba(46,230,214,.35);
      background: linear-gradient(180deg, rgba(46,230,214,.18), rgba(255,255,255,.05));
      box-shadow: 0 10px 26px rgba(46,230,214,.10);
    }
    .dot{width:8px;height:8px;border-radius:99px;background:rgba(255,255,255,.25)}
    .dot.global{background: var(--aqua)}
    .dot.apac{background: var(--green)}
    .dot.th{background: var(--pink)}
    .dot.research{background: var(--lav)}
    .select{
      flex: 0 0 auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      outline:0;
    }

    .news-grid{
      display:grid;gap:12px;
      grid-template-columns: repeat(12, 1fr);
      margin-top:10px;
    }
    .news-card{
      grid-column: span 6;
      padding:14px;
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .news-card:before{
      content:"";
      position:absolute;inset:-1px;
      background: radial-gradient(420px 220px at 10% 0%, rgba(46,230,214,.14), transparent 60%),
                  radial-gradient(420px 240px at 90% 40%, rgba(182,166,255,.10), transparent 60%);
      opacity:.9;pointer-events:none;
    }
    .news-card > *{position:relative}
    @media (max-width: 980px){ .news-card{grid-column: span 12} }
    .badge-row{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:8px}
    .badge{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size:12px;color:var(--muted);
    }
    .badge strong{color:var(--text)}
    .mini{
      font-size:12px;color:var(--muted);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:45%;
    }
    .h2{
      margin:0 0 8px;
      font-size:16px;
      letter-spacing:.2px;
    }
    .summary{
      margin:0 0 10px;
      color:rgba(245,251,255,.78);
      font-size:13px;
    }
    .imp{
      margin:0 0 10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(66,245,141,.25);
      background: linear-gradient(180deg, rgba(66,245,141,.12), rgba(255,255,255,.03));
      color:rgba(245,251,255,.85);
      font-size:13px;
    }
    .card-actions{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    }
    .linkbtn{
      text-decoration:none;
      display:inline-flex;gap:8px;align-items:center;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:9px 12px;
      color:var(--text);
      font-size:13px;
      box-shadow: 0 10px 26px rgba(0,0,0,.20);
    }
    .linkbtn:hover{background: rgba(255,255,255,.10)}
    .copybtn{
      border-radius:14px;
      border:1px solid rgba(46,230,214,.28);
      background: linear-gradient(180deg, rgba(46,230,214,.16), rgba(255,255,255,.05));
      padding:9px 12px;
      color:var(--text);
      font-size:13px;
      cursor:pointer;
      display:inline-flex;gap:8px;align-items:center;
      box-shadow: 0 10px 26px rgba(46,230,214,.10);
    }
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background: rgba(0,0,0,.62);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      backdrop-filter: blur(10px);
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
      font-size:13px;
      opacity:0;pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}
    .foot{
      margin-top:18px;
      color:rgba(245,251,255,.55);
      font-size:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .errbox{
      margin-top:10px;
      border-radius:16px;
      border:1px solid rgba(255,176,32,.25);
      background: rgba(255,176,32,.08);
      padding:12px;
      color: rgba(245,251,255,.85);
      display:none;
    }
    .errbox b{color:var(--text)}
  </style>
</head>
<body>
  <div class="grid-bg"></div>

  <div class="topbar">
    <div class="topbar-inner">
      <div class="row">
        <div class="brand">
          <div class="globe"><span>üåç</span></div>
          <div class="title">
            <b>Global Health & Wellness News</b>
            <small>‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÇ‡∏•‡∏Å‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÉ‡∏ô 2 ‡∏ô‡∏≤‡∏ó‡∏µ ‚Ä¢ Daily actionable intel</small>
          </div>
        </div>

        <div class="actions">
          <div class="pill" id="statusPill">
            <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
            <b id="lastUpdated">‚Äî</b>
          </div>
          <div class="pill">
            <span>Calls</span>
            <b id="calls">‚Äî</b>
            <span id="runStatus" style="color:var(--muted)">‚Äî</span>
          </div>
          <button class="btn primary" id="refreshBtn" title="Refresh">
            ‚ö° <span>Refresh</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <section class="hero">
      <h1>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÇ‡∏•‡∏Å (Global Health & Wellness Dashboard)</h1>
      <p>‡∏î‡∏π‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå ‚Ä¢ ‡∏≠‡πà‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö ‚Ä¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ ‚Äú‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πà‡∏≠‚Äù (Trends ‚Üí Actions)</p>

      <div class="cards3">
        <div class="card card3-1">
          <div class="kicker">
            <b>Trend Radar (‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå‡πÄ‡∏î‡πà‡∏ô)</b>
            <small>3 bullets</small>
          </div>
          <ul class="bullets" id="trendList"></ul>
        </div>

        <div class="card card3-2">
          <div class="kicker">
            <b>Strategic Moves (‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£)</b>
            <small>3 actions</small>
          </div>
          <ul class="bullets" id="strategicList"></ul>
        </div>

        <div class="card card3-3">
          <div class="kicker">
            <b>Thailand Pulse (‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢)</b>
            <small>local</small>
          </div>
          <ul class="bullets" id="localList"></ul>
        </div>
      </div>

      <div class="errbox" id="errBox">
        <b>‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î (Partial/Errors):</b>
        <div id="errText" style="margin-top:6px;color:rgba(245,251,255,.8)"></div>
      </div>
    </section>

    <section class="controls">
      <div class="search" title="Search">
        üîé
        <input id="searchInput" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ / Search (title, summary, source)..." />
      </div>

      <div class="chips" role="tablist" aria-label="Filters">
        <div class="chip active" data-filter="all" role="tab" aria-selected="true">
          <span class="dot"></span> All
        </div>
        <div class="chip" data-filter="global" role="tab">
          <span class="dot global"></span> Global
        </div>
        <div class="chip" data-filter="apac" role="tab">
          <span class="dot apac"></span> APAC
        </div>
        <div class="chip" data-filter="thailand" role="tab">
          <span class="dot th"></span> Thailand
        </div>
        <div class="chip" data-filter="research" role="tab">
          <span class="dot research"></span> Research
        </div>
      </div>

      <select class="select" id="sortSelect" title="Sort">
        <option value="reputable">Sort: Reputable first</option>
        <option value="title">Sort: Title A‚ÜíZ</option>
        <option value="tag">Sort: Query tag</option>
      </select>
    </section>

    <section>
      <div class="news-grid" id="newsGrid"></div>
      <div class="foot">
        <div id="footLeft">‚Äî</div>
        <div>‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ú‡πà‡∏≤‡∏ô LINE ‚Ä¢ Viewers: no login ‚Ä¢ Static JSON only</div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <script>
    // ---- Config ----
    const DATA_URL = "./data.json";
    const RESEARCH_TAG_PREFIX = "RESEARCH_"; // adjust if you use different tags

    // ---- State ----
    let RAW = null;
    let ITEMS = [];
    let FILTER = "all";
    let SEARCH = "";
    let SORT = "reputable";

    // ---- Elements ----
    const lastUpdatedEl = document.getElementById("lastUpdated");
    const callsEl = document.getElementById("calls");
    const runStatusEl = document.getElementById("runStatus");
    const trendList = document.getElementById("trendList");
    const strategicList = document.getElementById("strategicList");
    const localList = document.getElementById("localList");
    const newsGrid = document.getElementById("newsGrid");
    const footLeft = document.getElementById("footLeft");
    const errBox = document.getElementById("errBox");
    const errText = document.getElementById("errText");
    const toast = document.getElementById("toast");

    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1200);
    }

    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    function safeArr(x){ return Array.isArray(x) ? x : []; }

    function regionToFilter(region){
      // data.json uses local/regional/global
      if(region === "global") return "global";
      if(region === "regional") return "apac";
      if(region === "local") return "thailand";
      return "all";
    }

    function itemMatchesFilter(it){
      if(FILTER === "all") return true;

      if(FILTER === "research"){
        const tag = String(it.query_tag || "");
        return tag.startsWith(RESEARCH_TAG_PREFIX);
      }

      // global/apac/thailand from region
      return regionToFilter(it.region) === FILTER;
    }

    function itemMatchesSearch(it){
      if(!SEARCH) return true;
      const hay = [
        it.title, it.summary, it.source, it.strategic_implication, it.query_tag, it.region
      ].map(v => String(v||"").toLowerCase()).join(" ");
      return hay.includes(SEARCH.toLowerCase());
    }

    function reputableRank(it){
      // meta sorting already done server-side, but keep a stable client-side option
      const src = String(it.source||"").toLowerCase();
      const known = ["who","cdc","nih","harvard","lancet","nature","mayo","johns hopkins","stanford","cleveland clinic","bmj","jama","nejm"];
      return known.some(k => src.includes(k)) ? 0 : 1;
    }

    function sortItems(arr){
      const out = [...arr];
      if(SORT === "reputable"){
        out.sort((a,b)=>{
          const ra = reputableRank(a), rb = reputableRank(b);
          if(ra !== rb) return ra - rb;
          return String(a.title||"").localeCompare(String(b.title||""));
        });
      } else if(SORT === "title"){
        out.sort((a,b)=>String(a.title||"").localeCompare(String(b.title||"")));
      } else if(SORT === "tag"){
        out.sort((a,b)=>String(a.query_tag||"").localeCompare(String(b.query_tag||"")));
      }
      return out;
    }

    function buildLineText(it){
      const title = it.title || "";
      const summary = it.summary || "";
      const source = it.source || "";
      const url = it.url || "";
      const imp = it.strategic_implication || "";
      const tag = it.query_tag || "";
      const region = it.region || "";
      const badge = regionToFilter(region).toUpperCase();

      // Friendly, compact for LINE
      return [
        `üåçüß¨ Global Health & Wellness News`,
        `üè∑Ô∏è ${badge} ‚Ä¢ ${tag}`,
        ``,
        `üì∞ ${title}`,
        `üß† ‡∏™‡∏£‡∏∏‡∏õ: ${summary}`,
        `üéØ What it means: ${imp}`,
        `üîé Source: ${source}`,
        url ? `üîó ${url}` : `üîó (no link)`,
      ].join("\n");
    }

    function renderSummary(){
      const meta = RAW?.meta || {};
      const exec = RAW?.executive_summary || {};

      lastUpdatedEl.textContent = meta.generated_at_local || meta.generated_at_iso || "‚Äî";
      callsEl.textContent = (meta.calls_used != null && meta.calls_budget != null)
        ? `${meta.calls_used}/${meta.calls_budget}`
        : "‚Äî";

      const partial = !!meta.partial;
      runStatusEl.textContent = partial ? "PARTIAL" : "OK";
      runStatusEl.style.color = partial ? "var(--amber)" : "var(--green)";

      // bullets
      const trends = safeArr(exec.trends);
      const strategic = safeArr(exec.strategic);
      const local = safeArr(exec.local);

      trendList.innerHTML = trends.length ? trends.map(x=>`<li>${esc(x)}</li>`).join("") : `<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡∏£‡∏ô‡∏î‡πå</li>`;
      strategicList.innerHTML = strategic.length ? strategic.map(x=>`<li>${esc(x)}</li>`).join("") : `<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå</li>`;
      localList.innerHTML = local.length ? local.map(x=>`<li>${esc(x)}</li>`).join("") : `<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ</li>`;

      // errors
      const errors = safeArr(RAW?.errors);
      if(errors.length){
        errBox.style.display = "block";
        const txt = errors.map(e => `‚Ä¢ ${e.query_tag || "?"}: ${e.message || e.error_type || "error"}`).join("<br/>");
        errText.innerHTML = txt;
      } else {
        errBox.style.display = "none";
        errText.textContent = "";
      }

      footLeft.textContent = meta.notes || `Loaded ${safeArr(RAW?.items).length} items`;
    }

    function badgeForItem(it){
      const f = regionToFilter(it.region);
      if(f === "global") return {label:"Global", color:"var(--aqua)"};
      if(f === "apac") return {label:"APAC", color:"var(--green)"};
      if(f === "thailand") return {label:"Thailand", color:"var(--pink)"};
      // research tag overrides label
      const tag = String(it.query_tag||"");
      if(tag.startsWith(RESEARCH_TAG_PREFIX)) return {label:"Research", color:"var(--lav)"};
      return {label:"All", color:"rgba(255,255,255,.22)"};
    }

    function renderGrid(){
      const filtered = ITEMS
        .filter(itemMatchesFilter)
        .filter(itemMatchesSearch);

      const sorted = sortItems(filtered);

      if(!sorted.length){
        newsGrid.innerHTML = `
          <div class="news-card" style="grid-column: span 12;">
            <div class="badge-row">
              <span class="badge"><strong>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</strong></span>
              <span class="mini">No results</span>
            </div>
            <p class="summary">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô filter ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö</p>
          </div>
        `;
        return;
      }

      newsGrid.innerHTML = sorted.map((it)=>{
        const b = badgeForItem(it);
        const url = it.url ? String(it.url) : "";
        const src = it.source ? String(it.source) : "‚Äî";
        const summary = it.summary ? String(it.summary) : "";
        const imp = it.strategic_implication ? String(it.strategic_implication) : "";
        const tag = it.query_tag ? String(it.query_tag) : "‚Äî";

        return `
          <article class="news-card">
            <div class="badge-row">
              <span class="badge" title="Category">
                <span class="dot" style="background:${b.color}"></span>
                <strong>${esc(b.label)}</strong>
                <span style="opacity:.75">‚Ä¢</span>
                <span>${esc(tag)}</span>
              </span>
              <span class="mini" title="Source">${esc(src)}</span>
            </div>

            <h3 class="h2">${esc(it.title || "")}</h3>
            <p class="summary">${esc(summary)}</p>

            <div class="imp">
              <b style="color:var(--green)">Strategic Implication:</b>
              <div style="margin-top:6px">${esc(imp || "‚Äî")}</div>
            </div>

            <div class="card-actions">
              <a class="linkbtn" href="${url ? esc(url) : "#"}" target="_blank" rel="noopener noreferrer" ${url ? "" : "onclick='return false;'"}>
                üîó <span>${url ? "Open ‚Üó" : "No link"}</span>
              </a>
              <button class="copybtn" data-copy="1">
                üìã <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡πà‡∏á LINE</span>
              </button>
            </div>
          </article>
        `;
      }).join("");

      // attach copy handlers
      newsGrid.querySelectorAll("button[data-copy='1']").forEach((btn, idx)=>{
        btn.addEventListener("click", async ()=>{
          const visibleItems = sortItems(ITEMS.filter(itemMatchesFilter).filter(itemMatchesSearch));
          const it = visibleItems[idx];
          if(!it) return;
          const text = buildLineText(it);
          try{
            await navigator.clipboard.writeText(text);
            showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
          } catch {
            // fallback
            const ta = document.createElement("textarea");
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand("copy");
            ta.remove();
            showToast("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ");
          }
        });
      });
    }

    async function loadData(){
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("Failed to load data.json");
      const data = await res.json();
      RAW = data;
      ITEMS = safeArr(data.items);
      renderSummary();
      renderGrid();
    }

    // ---- Events ----
    document.getElementById("refreshBtn").addEventListener("click", ()=>{
      // simple refresh: reload page (no API calls)
      location.reload();
    });

    document.getElementById("searchInput").addEventListener("input", (e)=>{
      SEARCH = e.target.value || "";
      renderGrid();
    });

    document.getElementById("sortSelect").addEventListener("change", (e)=>{
      SORT = e.target.value || "reputable";
      renderGrid();
    });

    document.querySelectorAll(".chip").forEach(ch=>{
      ch.addEventListener("click", ()=>{
        document.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
        ch.classList.add("active");
        FILTER = ch.getAttribute("data-filter") || "all";
        renderGrid();
      });
    });

    // ---- Boot ----
    (async ()=>{
      try{
        await loadData();
      } catch (e){
        lastUpdatedEl.textContent = "‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        runStatusEl.textContent = "ERROR";
        runStatusEl.style.color = "var(--amber)";
        errBox.style.display = "block";
        errText.innerHTML = "‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå data.json ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ Pages ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï<br/>‚Ä¢ ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ data.json ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö dashboard.html";
        newsGrid.innerHTML = `
          <div class="news-card" style="grid-column: span 12;">
            <div class="badge-row">
              <span class="badge"><strong>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</strong></span>
              <span class="mini">Cannot load data.json</span>
            </div>
            <p class="summary">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ <b>data.json</b> ‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞ GitHub Pages deploy ‡πÅ‡∏•‡πâ‡∏ß</p>
          </div>
        `;
      }
    })();
  </script>
</body>
</html>
